<template name="MobileGame">

  {{#contentFor "headerButtonLeft"}}
    {{>ionNavBackButton class="" text=false}}
  {{/contentFor}}

  {{#contentFor "headerButtonRight"}}
    <button id="side-menu-button" menu-toggle="left" class="button button-clear pull-right">
      {{> ionIcon icon='navicon'}}
    </button>
  {{/contentFor}}

  {{#contentFor "headerTitle"}}
    <h1 class="title">{{ game.title }}</h1>
  {{/contentFor}}

  {{#ionView}}
    {{#ionContent}}

    
 	{{#with current_bet }}
 	<!-- TODO: "See Nearby People" feature -->
 		<!-- <button id="see-nearby-people">
 			See Nearby People
 		</button>
 		<div>
 			{{users_nearby}}
 		</div> -->

 		{{#if is_user_bankrupt }}
	 		<button id="buy-chips-button" class="button button-balanced" style="margin-bottom: 0px;margin-top: 10px;">
	 	 		{{#if currentUser.bank_request_more_funds}}
	 	 		    <p>No more refills....</p>
	 	 		{{else}}
	 	 		    <p>Request Refill (only once)</p>
	 	 		{{/if}}
			</button>
		{{ else }}
		    {{#unless getSessionValue "usingVerySmallScreen"}}
		    <div class="bet-amount-div" style="margin-bottom: 0px" align="center">
    		    <button id="bet-amount-button-neg" class="btn btn-lg btn-danger" style="margin-top:4px;margin-bottom:4px">-</button>
    			<button id="bet-amount-button" style="margin-top:4px;margin-bottom:4px" class="button button-positive" >
    	 	 		<p class="bet-amount-value">{{ formatted_bet_amount }}</p>
    	 	 		<p class="bet-amount-label">Bet amount</p>
    			</button>
    			<button style="margin-top:4px;margin-bottom:4px" id="bet-amount-button-pos" class="btn btn-lg btn-success">+</button>
			</div>
			{{/unless}}
		{{/if}}
	
 		<div class="card" style="margin-top: 5px;margin-left:5px;margin-right:5px;margin-bottom:5px;">
		  <div id="bet-question-wrapper" class="item item-divider" style=" white-space: normal;padding-top:4px;padding-bottom:4px">
		  <!-- MAX: TODO - fix the white-space:normal thing I did above... -->
		    {{#if question}}
		        {{ question }}
		    {{else}}
		        <h1 class='text-center' style="margin-bottom: 0px;font-size: 22px;">More Bets Coming Soon!</h1>
		        <!--<span id='leaderboard-subtext'>Check this page often to see new bets</span>-->
		    {{/if}}
		  </div>
		  <div id="bet-answer-wrapper" class="item item-text-wrap" style="padding-bottom: 6px;padding-top: 0px;">
		  {{#if status }} <!-- crude way to check whether there's a status, i.e. there's a bet-->
		  	  {{#each addIndexesToArray outcomes }}
		  	    {{#if notEmptyString text}}
		  	    <div class="bet-option-div" style="padding-bottom: 5px; padding-top: 5px;">
				  	<button class="button button-balanced bet-option-button" data-index-for-ref="{{index_for_ref}}" {{disable_based_on_bank_account}}>
				  		{{ text }}
				  		<p class='clearfix'>
				  			<span class='odds-text pull-left'>{{ odds }}:1</span>
				  			<span class='win-text pull-right'>{{ formatted_win_value }}</span>
				  		</p>
					</button>
					{{#unless getSessionValue "usingSmallScreen"}}
					<div class='user-face-wrapper clearfix'>
					{{#each users_in_question index_for_ref }}
						<div class='user-face'>
							<span class='user-face-grey'>?</span>
							<img class='user-face-image' src={{ profile.image.small }} />
						</div>
					{{/each}}
					</div>
					{{/unless}}
				</div>
				{{/if}}
			  {{/each}}
			  <br>
			  <a href="#" id="bet-skip-button" class='button button-stable'>skip</a>
			  <br>
		    {{else}} <!--  No current bet-->
	            {{> LeaderboardPreview }}
	        {{/if}}
		    </div>
		</div> <!-- END QUESTION -->
	{{/with}}
	
    {{/ionContent}}
    {{#ionFooterBar class="large-footer"}}
		<div id="footer-content" class="text-center">
		  <div class="recess bet-user-bank">  	
		  	<span>
		  		{{ formatted_bank_account }}
		  	</span>
		  </div>
		  {{#if current_status_message }}
    		  <div class="bet-status-message">
    		  	<p class="status_message">{{ current_status_message }}</p>
    		  </div>
		  {{else}}
		    <div class="bet-ongoing-stats">
		  	     <span>{{ number_bets }} bets 
		  	    <!--(total <span class="text-info">${{ value_bets}}</span>) -->
		  	    pending -- can win additional <span class="text-info">{{numberFormatBy currentUser.user_stats.potential_winnings '$0,0'}}</span>!</span>
		    </div>
		  {{/if}}
	  </div>
	{{/ionFooterBar}}
  {{/ionView}}
</template>






<template name="LeaderboardPreview">
    <h1 style="margin-bottom: 0px;font-size: 18px;text-align:center;">You are currently <span class="text-info">#{{getPositionsInLeaderboard currentUser._id}}</span> of {{getTotalNumOfUsers}} Players</h1>
    <span id='leaderboard-subtext'>See full leaderboard by clicking on the menu icon below</span>
    <!--<h2>If you win all your bets, you'll have <span class="text-info">${{addTwoNumbers currentUser.user_stats.potential_winnings currentUser.bank_account}}</span></h2>-->
    <!--<h2>Click on the Leaderboard icon below to see how others are doing</h2>-->
    <!--<br>-->
    <!--<h2>Click the Active Bets or History icons below to see your previous bets</h2>-->
    <!--<br>-->
    <!--<h2>Click the Chat icon below to chat and trash talk</h2>-->
    
    <!--<br>-->
    
    <table class="table table-condensed" style="margin-bottom: 2px;">
        <thead>
            <tr>
                <th>#</th>
                <th></th>
                <th>{{> ionIcon icon='android-contact' class='leaderboard-person' }}</th>
                <th>{{> ionIcon icon='social-usd' class='leaderboard-money' }}</th>
                <!--<th>{{> ionIcon icon='checkmark' class='leaderboard-tick' }}</th>-->
                <th style="padding-right: 1px;">Potential</th>
            </tr>
        </thead>
        <tbody>
            {{#each getUserLeaderboardPreview}}
                <tr class="{{#if highlightMyselfOnTable}}balanced{{/if}}" style="{{#if highlightMyselfOnTable}}font-size: larger; font-weight: bolder; {{/if}}">
                    <td>{{getPositionsInLeaderboard _id}}</td>
                    <td style="padding-bottom: 0px;"><img class="profile-pic" src="{{ profile.image.small }}"></td>
                    <td>{{profile.name}}</td>
                    <td>{{numberFormatBy bank_account '$0,0'}}</td>
                    <!--<td>{{numberFormatBy user_stats.bets_won_percentage '0,0%'}}</td>-->
                    <td style="padding-right: 1px;">${{addTwoNumbers user_stats.potential_winnings bank_account}}</td>
                </tr>
            {{/each}}
            <!--<tr><td>...</td><td></td><td></td><td></td><td></td><td></td></tr>-->
            
            {{#unless getSessionValue 'LeaderboardAmIinTop3'}}
            <tr class="balanced" style="font-size: larger; font-weight: bolder;">
                 <td>{{getPositionsInLeaderboard currentUser._id}}</td>
                <td style="padding-bottom: 0px;"><img class="profile-pic" src="{{ currentUser.profile.image.small }}"></td>
                <td>{{currentUser.profile.name}}</td>
                <td>{{numberFormatBy currentUser.bank_account '$0,0'}}</td>
                <!--<td>{{numberFormatBy currentUser.user_stats.bets_won_percentage '0,0%'}}</td>-->
                <td style="padding-right: 1px;">${{addTwoNumbers currentUser.user_stats.potential_winnings currentUser.bank_account}}</td>
            </tr>
            {{/unless}}
        </tbody>
    </table>
    
    <div id='login-button-wrapper' class='text-center'>
    <a id='facebook-login-button-for-guest' class="login-button" title="Login with Facebook">
  		<img src="/images/facebook-button.png" alt="Login with Facebook">
  	</a>
  	</div>
    
</template>